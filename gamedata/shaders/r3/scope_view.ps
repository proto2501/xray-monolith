#include "common.h"

float4 scope_view_params; // x, y, size, magnification

float4 main(p_screen I,  float4 pos2d : SV_POSITION) : SV_Target
{
    float2 center = float2(scope_view_params.x, scope_view_params.y);
    float size = scope_view_params.z;
    float magnification = scope_view_params.w;

    float aspectRatio = screen_res.x / screen_res.y;
    
    float2 coord;
    coord.x = (I.tc0.x - 0.5) * aspectRatio;
    coord.y = I.tc0.y - 0.5;
    float dist = distance(coord, center - float2(0.5, 0.5));
    
    float2 texCoord;
    if (dist < size / 2)
    {
        texCoord.x = (coord.x / magnification) / aspectRatio + 0.5;
        texCoord.y = coord.y / magnification + 0.5;
    }
    else
    {
        texCoord = I.tc0;
    }
    
    float3 colour = s_image.Sample(smp_base, texCoord);
    return float4(colour, 1.0);
} 
